<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tutu.point.mapper.AccountPointDetailMapper">

    <!-- 分页查询积分详情（带账户名称） -->
    <select id="pageDetailWithJoin" resultType="com.tutu.point.entity.AccountPointDetail">
        SELECT 
            d.*,
            a.nickname as accountName
        FROM account_point_detail d
        LEFT JOIN account a ON d.account_id = a.id AND (a.is_deleted = 0 OR a.is_deleted IS NULL)
        <where>
            d.is_deleted = '0'
            <if test="accountId != null and accountId != ''">
                AND d.account_id = #{accountId}
            </if>
            <if test="changeType != null and changeType != ''">
                AND d.change_type = #{changeType}
            </if>
            <if test="changeDirection != null and changeDirection != ''">
                AND d.change_direction = #{changeDirection}
            </if>
        </where>
        ORDER BY d.create_time DESC
    </select>
    
    <!-- 根据账户ID查询积分详情列表（带账户名称） -->
    <select id="getByAccountIdWithJoin" resultType="com.tutu.point.entity.AccountPointDetail">
        SELECT 
            d.*,
            a.nickname as accountName
        FROM account_point_detail d
        LEFT JOIN account a ON d.account_id = a.id AND (a.is_deleted = 0 OR a.is_deleted IS NULL)
        WHERE d.is_deleted = '0' AND d.account_id = #{accountId}
        ORDER BY d.create_time DESC
    </select>
    
    <!-- 根据账户ID和变更类型查询积分详情列表（带账户名称） -->
    <select id="getByAccountIdAndChangeTypeWithJoin" resultType="com.tutu.point.entity.AccountPointDetail">
        SELECT 
            d.*,
            a.nickname as accountName
        FROM account_point_detail d
        LEFT JOIN account a ON d.account_id = a.id AND (a.is_deleted = 0 OR a.is_deleted IS NULL)
        <where>
            d.is_deleted = '0' AND d.account_id = #{accountId}
            <if test="changeType != null and changeType != ''">
                AND d.change_type = #{changeType}
            </if>
        </where>
        ORDER BY d.create_time DESC
    </select>

</mapper>

