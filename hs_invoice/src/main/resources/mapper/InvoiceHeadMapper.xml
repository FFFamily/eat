<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tutu.invoice.mapper.InvoiceHeadMapper">

    <!-- 根据账号ID查询发票抬头列表 -->
    <select id="selectByAccountId" resultType="com.tutu.invoice.entity.InvoiceHead">
        SELECT * FROM invoice_head 
        WHERE account_id = #{accountId}
        ORDER BY is_default DESC, create_time DESC
    </select>

    <!-- 根据账号ID查询默认发票抬头 -->
    <select id="selectDefaultByAccountId" resultType="com.tutu.invoice.entity.InvoiceHead">
        SELECT * FROM invoice_head 
        WHERE account_id = #{accountId} AND is_default = true
        LIMIT 1
    </select>

    <select id="findPage" resultType="com.tutu.invoice.entity.InvoiceHead">
        SELECT h.*, a.nickname as accountName FROM invoice_head h
        left join account a on h.account_id = a.id
        <where>
            <if test="invoiceHead.accountName != null and invoiceHead.accountName != ''">
                AND a.nickname like '%${invoiceHead.accountName}%'
            </if>
            <if test="invoiceHead.taxNumber != null and invoiceHead.taxNumber != ''">
                AND h.tax_number like '%${invoiceHead.taxNumber}%'
            </if>
        </where>
        limit #{pageNum}, #{pageSize}
    </select>   

    <select id="findPageCount" resultType="long">
        SELECT count(*) FROM invoice_head h
        left join account a on h.account_id = a.id
        <where>
            <if test="invoiceHead.accountName != null and invoiceHead.accountName != ''">
                AND a.nickname like '%${invoiceHead.accountName}%'
            </if>
            <if test="invoiceHead.taxNumber != null and invoiceHead.taxNumber != ''">
                AND h.tax_number like '%${invoiceHead.taxNumber}%'
            </if>
        </where>
    </select>
</mapper> 